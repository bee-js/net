{"version":3,"file":"net.js","sources":["../../.gobble-build/01-source/net.js"],"sourcesContent":["'use strict';\n\nlet net = {},\n    win = window,\n    contentTypeHandlers = {},\n    contentTypes = {},\n    getXhr;\n\nconst responseTypes = {\n  'arraybuffer': true,\n  'blob':        true,\n  'document':    true,\n  'text':        true\n}\n\nconst statusTypes = [null, 'info', 'success', 'redirect', 'clientError', 'serverError'];\n\nconst lineEndReg = /\\r?\\n/;\n\nfunction isObject(obj) { return obj === Object(obj); }\n\nnet.Promise = ('Promise' in win) ? win.Promise : null;\nnet.defaultOptions = {\n  async: true,\n  type: 'urlencoded'\n};\n\nnet.serializeObject = function(obj) {\n  if (!isObject(obj)) return obj;\n\n  let pairs = [];\n  for (let key in obj) {\n    let value = (obj[key] == void 0) ? true : obj[key];\n    pairs.push(`${encodeURIComponent(key)}=${encodeURIComponent(value)}`);\n  }\n  return pairs.join('&');\n}\n\n/**\n * Add custom contentType handler\n *\n *     net.setHandler('application/x-www-form-urlencoded', {\n *       name: 'urlencoded',\n *       getter: QueryString.parse,\n *       setter: QueryString.stringify\n *     });\n *\n *     net.setHandler('text/plain', 'text');\n *\n *     net.setHandler({\n *       name: 'text',\n *       getter: String.prototype.trim\n *     });\n */\nnet.setHandler = function(name, options) {\n  var opts = {}\n\n  if (typeof(options) == 'string') {\n    opts.contentTypes = [options];\n  } else if(Array.isArray(options)) {\n    opts.contentTypes = options;\n  }\n\n  if (isObject(name)) {\n    Object.assign(opts, name);\n  } else {\n    opts.name = name;\n    Object.assign(opts, options);\n  }\n\n  opts.contentTypes.forEach(ct => { contentTypes[ct] = name; })\n\n  contentTypeHandlers[name] = opts;\n\n  return name;\n};\n\nnet.setHandler('html', 'text/html');\nnet.setHandler('urlencoded', {\n  contentTypes: ['application/x-www-form-urlencoded'],\n  setter: net.serializeObject\n});\n\nnet.setHandler('json', {\n  contentTypes: ['application/json'],\n  getter: JSON.parse, // IE 10-11 does not supports responseType JSON\n  setter: JSON.stringify\n});\n\n/**\n * Response object\n */\nfunction Response(xhr, request) {\n  let status       = xhr.status,\n      contentType  = xhr.getResponseHeader('Content-Type'),\n      responseText = xhr.responseText;\n\n  // IE9 fix http://stackoverflow.com/questions/10046972/msie-returns-status-code-of-1223-for-ajax-request\n  if (status === 1223) status = 204;\n\n  contentType = (contentType || '').split(';')[0];\n\n  // Create stubs for responses\n  this.info        = false;\n  this.success     = false;\n  this.redirect    = false;\n  this.clientError = false;\n  this.serverError = false;\n\n  // Inject origins\n  this.xhr     = xhr;\n  this.request = request;\n\n  // Set status props\n  this.status     = status;\n  this.statusType = statusTypes[status / 100 | 0];\n  this.statusText = xhr.statusText;\n  this[this.statusType] = true;\n\n  this.error = this.clientError || this.serverError;\n\n  // Set headers props\n  this._parseHeaders(xhr.getAllResponseHeaders());\n  this.contentType = contentType;\n  this.type = contentTypes[contentType];\n\n  // Set body props\n  this.text = responseText;\n\n  if (xhr.responseType != '' && responseTypes[xhr.responseType]) {\n    this[xhr.responseType] = this.body = xhr.response; // TODO: XML response\n  } else this._parseResponseBody();\n}\n\nResponse.prototype = {\n  getHeader: function(key) {\n    return this._headers[key.toLowerCase()];\n  },\n\n  _parseHeaders: function(data) {\n    let headers  = data.split(lineEndReg),\n        result   = {},\n        downcase = {},\n        l = headers.length - 1,\n        i = 0;\n\n    headers.pop();\n\n    while(i < l) {\n      let header = headers[i++],\n          parts  = header.split(':'),\n          key    = parts.shift(),\n          value  = parts.join(':').trim();\n\n      result[key] = value;\n      downcase[key.toLowerCase()] = value;\n    }\n\n    this.headers  = result;\n    this._headers = downcase;\n  },\n\n  _parseResponseBody: function() {\n    let type    = contentTypes[this.contentType],\n        handler = contentTypeHandlers[this.type],\n        body    = this.text;\n\n    if (type && handler && handler.getter) {\n      try {\n        this[type] = this.body = handler.getter.call(body, body);\n      } catch(e) {\n        this.body = body;\n      }\n    } else {\n      this.body = body;\n    }\n  }\n};\n\nfunction Request(type, url, options) {\n  this.method  = type.toUpperCase();\n  this.path    = url;\n  this.data    = {};\n  this.form    = null;\n  this.options = Object.create(net.defaultOptions);\n  this.headers = {};\n}\n\nRequest.prototype = {\n  set: function(key, value) {\n    if (key instanceof FormData) { // TODO: File, Blob, ArrayBuffer\n      this.form = key;\n    } else if (value === void 0) {\n      if (isObject(key)) {\n        Object.assign(this.data, key);\n      } else this.data[key] = true;\n    } else this.data[key] = value;\n\n    return this;\n  },\n\n  setHeader: function(key, value) {\n    if (value === void 0 && isObject(key)) {\n      Object.assign(this.headers, key);\n    } else this.headers[key] = value;\n\n    return this;\n  },\n\n  setOption: function(opt, val) {\n    this.options[opt] = val;\n    return this;\n  },\n\n  async: function(val) {\n    return this.setOption('async', val);\n  },\n\n  timeout: function(val) {\n    return this.setOption('timeout', val);\n  },\n\n  type: function(val) {\n    return this.setOption('type', val);\n  },\n\n  send: function() {\n    let xhr = new win.XMLHttpRequest(),\n        self = this,\n        type = self.options.type,\n        url  = self.path,\n        responseType = self.options.responseType,\n        handler = contentTypeHandlers[type],\n        headers = Object.create(self.headers),\n        data;\n\n    if (Object.keys(self.data).length > 0 || self.form) {\n      if (self.method === 'GET') {\n        data = null;\n        let query = net.serializeObject(self.data);\n        if (query !== '') url += ~url.indexOf('?') ? '&' + query : '?' + query;\n      } else if (self.form) {\n        data = self.form;\n        for (let key in self.data) data.append(key, data);\n      } else if (handler && handler.setter) {\n        data = handler.setter.call(self.data, self.data);\n        if (!('Content-Type' in headers)) headers['Content-Type'] = handler.contentTypes[0];\n      } else data = self.data;\n    }\n\n    xhr.open(self.method, url, self.options.async);\n\n    if (responseType && responseTypes[responseType]) {\n      xhr.responseType = responseType;\n    }\n\n    for (let header in headers) {\n      xhr.setRequestHeader(header, headers[header]);\n    }\n\n    return new net.Promise(function(resolve, reject) {\n      xhr.addEventListener('load', function() {\n        let response = new Response(xhr, self);\n\n        resolve(response);\n      });\n\n      xhr.addEventListener('error', ()=>{ reject(xhr) });\n\n      if (self.options.timeout) {\n        xhr.timeout = self.options.timeout;\n\n        xhr.addEventListener('timeout', ()=>{ reject(xhr) });\n      }\n\n      xhr.send(data);\n    });\n  }\n};\n\nnet.Request  = Request;\nnet.Response = Response;\n\nexport default net;\n"],"names":[],"mappings":"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"}