{"version":3,"file":"net.min.js","sources":["../../.gobble-build/01-source/net.js"],"sourcesContent":["'use strict';\n\nlet net = {},\n    win = window,\n    contentTypeHandlers = {},\n    contentTypes = {},\n    getXhr;\n\nconst responseTypes = {\n  'arraybuffer': true,\n  'blob':        true,\n  'document':    true,\n  'text':        true\n};\n\nconst nativeTypes = {\n  '[object ArrayBuffer]': true,\n  '[object Blob]': true,\n  '[object File]': true\n};\n\nconst statusTypes = [null, 'info', 'success', 'redirect', 'clientError', 'serverError'];\n\nconst lineEndReg = /\\r?\\n/;\n\nfunction isObject(obj) { return Object.prototype.toString.call(obj) === '[object Object]'; }\nfunction isNativeType(obj) {\n  return nativeTypes[Object.prototype.toString.call(obj)];\n}\nfunction defineReader(obj, prop, value) {\n  Object.defineProperty(obj, prop, { writable: false, value: value });\n}\n\nnet.Promise = ('Promise' in win) ? win.Promise : null;\nnet.defaultOptions = {\n  async: true,\n  type: 'urlencoded'\n};\n\nnet.serializeObject = function(obj) {\n  if (!isObject(obj)) return obj;\n\n  let pairs = [];\n  for (let key in obj) {\n    let value = (obj[key] == void 0) ? true : obj[key];\n    pairs.push(`${encodeURIComponent(key)}=${encodeURIComponent(value)}`);\n  }\n  return pairs.join('&');\n}\n\n/**\n * Add custom contentType handler\n *\n *     net.setHandler('urlencoded', {\n *       contentTypes: ['application/x-www-form-urlencoded'],\n *       getter: QueryString.parse,\n *       setter: QueryString.stringify\n *     });\n *\n *     net.setHandler('text', 'text/plain');\n *\n *     net.setHandler({\n *       name: 'text',\n *       getter: String.prototype.trim\n *     });\n */\nnet.setHandler = function(name, options) {\n  var opts = {}\n\n  if (typeof(options) == 'string') {\n    opts.contentTypes = [options];\n  } else if(Array.isArray(options)) {\n    opts.contentTypes = options;\n  }\n\n  if (isObject(name)) {\n    Object.assign(opts, name);\n  } else {\n    opts.name = name;\n    Object.assign(opts, options);\n  }\n\n  opts.contentTypes.forEach(ct => { contentTypes[ct] = name; })\n\n  contentTypeHandlers[name] = opts;\n\n  return name;\n};\n\nnet.setHandler('html', 'text/html');\nnet.setHandler('urlencoded', {\n  contentTypes: ['application/x-www-form-urlencoded'],\n  setter: net.serializeObject\n});\n\nnet.setHandler('json', {\n  contentTypes: ['application/json'],\n  getter: JSON.parse, // IE 10-11 does not supports responseType JSON\n  setter: JSON.stringify\n});\n\n/**\n * Response object\n */\nfunction Response(xhr, request) {\n  let status       = xhr.status,\n      contentType  = xhr.getResponseHeader('Content-Type'),\n      responseText = xhr.responseText,\n      i = statusTypes.length, type, self = this;\n\n  // IE9 fix http://stackoverflow.com/questions/10046972/msie-returns-status-code-of-1223-for-ajax-request\n  if (status === 1223) status = 204;\n\n  contentType = (contentType || '').split(';')[0];\n\n  // Inject origins\n  this.xhr     = xhr;\n  this.request = request;\n\n  // Set status props\n  defineReader(self, 'status', status);\n  defineReader(self, 'statusType', statusTypes[status / 100 | 0]);\n  defineReader(self, 'statusText', xhr.statusText);\n\n  while (type=statusTypes[--i]) defineReader(this, type, type == this.statusType);\n\n  defineReader(self, 'error', this.clientError || this.serverError);\n\n  // Set headers props\n  self._parseHeaders(xhr.getAllResponseHeaders());\n\n  defineReader(self, 'contentType', contentType);\n  defineReader(self, 'type', request.options.responseType || contentTypes[contentType]);\n\n  // Set body props\n  defineReader(self, 'text', responseText);\n\n  if (xhr.responseType != '' && responseTypes[xhr.responseType]) {\n    // TODO: XML response\n    defineReader(self, xhr.responseType, xhr.response);\n    defineReader(self, 'body', xhr.response);\n  } else self._parseResponseBody();\n}\n\nResponse.prototype = {\n  getHeader: function(key) {\n    return this._headers[key.toLowerCase()];\n  },\n\n  _parseHeaders: function(data) {\n    let headers  = data.split(lineEndReg),\n        result   = {},\n        downcase = {},\n        l = headers.length - 1,\n        i = 0;\n\n    headers.pop();\n\n    while(i < l) {\n      let header = headers[i++],\n          parts  = header.split(':'),\n          key    = parts.shift(),\n          value  = parts.join(':').trim();\n\n      result[key] = value;\n      downcase[key.toLowerCase()] = value;\n    }\n\n    defineReader(this, 'headers', result);\n    defineReader(this, '_headers', downcase);\n  },\n\n  _parseResponseBody: function() {\n    let type    = this.type,\n        handler = contentTypeHandlers[type],\n        body    = this.text;\n\n    if (type && handler && handler.getter) {\n      try {\n        body = handler.getter.call(body, body);\n        defineReader(this, type, body);\n      } catch(e) {}\n    }\n\n    defineReader(this, 'body', body);\n  }\n};\n\nfunction Request(method, url, options) {\n  this.method  = method.toUpperCase();\n  this.path    = url;\n  this.data    = {};\n  this.form    = null;\n  this.options = Object.create(net.defaultOptions);\n  this.headers = {};\n}\n\nRequest.prototype = {\n  set: function(key, value) {\n    if (value === void 0) {\n      if (isObject(key)) {\n        Object.assign(this.data, key);\n      } else this.form = key;\n    } else {\n      if (isNativeType(value)) this.form = this.form || new FormData();\n      this.data[key] = value;\n    }\n\n    return this;\n  },\n\n  setHeader: function(key, value) {\n    if (value === void 0 && isObject(key)) {\n      Object.assign(this.headers, key);\n    } else this.headers[key] = value;\n\n    return this;\n  },\n\n  setOption: function(opt, val) {\n    this.options[opt] = val;\n    return this;\n  },\n\n  async: function(val) {\n    return this.setOption('async', val);\n  },\n\n  timeout: function(val) {\n    return this.setOption('timeout', val);\n  },\n\n  type: function(val) {\n    return this.setOption('type', val);\n  },\n\n  expect: function(val) {\n    return this.setOption('responseType', val);\n  },\n\n  send: function() {\n    let xhr = new win.XMLHttpRequest(),\n        self = this,\n        type = self.options.type,\n        url  = self.path,\n        responseType = self.options.responseType,\n        handler = contentTypeHandlers[type],\n        headers = Object.create(self.headers),\n        data;\n\n    // Content type '**/**'\n    if (~type.indexOf('/')) headers['Content-Type'] = type;\n\n    if (Object.keys(self.data).length > 0 || self.form) {\n      if (self.method === 'GET') { // No body\n        data = null;\n        let query = net.serializeObject(self.data);\n        if (query !== '') url += ~url.indexOf('?') ? '&' + query : '?' + query;\n      } else if (self.form) {\n        data = self.form;\n        if (data instanceof FormData) {\n          for (let key in self.data) data.append(key, data);\n        }\n      } else if (handler && handler.setter) {\n        data = handler.setter.call(self.data, self.data);\n      } else data = self.data;\n\n      if (handler && !('Content-Type' in headers)) headers['Content-Type'] = handler.contentTypes[0];\n    }\n\n    xhr.open(self.method, url, self.options.async);\n\n    if (responseType && responseTypes[responseType]) {\n      xhr.responseType = responseType;\n    }\n\n    for (let header in headers) {\n      xhr.setRequestHeader(header, headers[header]);\n    }\n\n    return new net.Promise(function(resolve, reject) {\n      xhr.addEventListener('load', function() {\n        let response = new Response(xhr, self);\n\n        resolve(response);\n      });\n\n      xhr.addEventListener('error', ()=>{ reject(xhr) });\n\n      if (self.options.timeout) {\n        xhr.timeout = self.options.timeout;\n\n        xhr.addEventListener('timeout', ()=>{ reject(xhr) });\n      }\n\n      xhr.send(data);\n    });\n  }\n};\n\nnet.Request  = Request;\nnet.Response = Response;\n\nexport default net;\n"],"names":["isObject","obj","Object","prototype","toString","call","isNativeType","nativeTypes","defineReader","prop","value","defineProperty","writable","Response","xhr","request","status","contentType","getResponseHeader","responseText","i","statusTypes","length","type","undefined","self","this","split","statusText","statusType","clientError","serverError","_parseHeaders","getAllResponseHeaders","options","responseType","contentTypes","responseTypes","response","_parseResponseBody","Request","method","url","toUpperCase","path","data","form","create","net","defaultOptions","headers","win","window","contentTypeHandlers","arraybuffer","blob","document","text","[object ArrayBuffer]","[object Blob]","[object File]","lineEndReg","Promise","async","serializeObject","pairs","key","push","encodeURIComponent","join","setHandler","name","opts","Array","isArray","assign","forEach","ct","setter","getter","JSON","parse","stringify","getHeader","_headers","toLowerCase","result","downcase","l","pop","header","parts","shift","trim","handler","body","e","set","FormData","setHeader","setOption","opt","val","timeout","expect","send","XMLHttpRequest","indexOf","keys","query","append","open","setRequestHeader","resolve","reject","addEventListener"],"mappings":"8KAyBA,SAASA,GAASC,GAAlB,MAAwE,oBAAxCC,OAAOC,UAAUC,SAASC,KAAKJ,GAC/D,QAASK,GAAaL,GACtB,MAASM,GAAYL,OAAOC,UAAUC,SAASC,KAAKJ,IAEpD,QAASO,GAAaP,EAAKQ,EAAMC,GACjCR,OAASS,eAAeV,EAAKQ,GAAQG,UAAU,EAAOF,MAAOA,IA0E7D,QAASG,GAASC,EAAKC,GACvB,GAAMC,GAAeF,EAAIE,OACnBC,EAAeH,EAAII,kBAAkB,gBACrCC,EAAeL,EAAIK,aACnBC,EAAIC,EAAYC,OAAQC,EAA9BC,OAAoCC,EAAOC,IAgB3C,KAbiB,OAAXV,IAAiBA,EAAS,KAEhCC,GAAiBA,GAAe,IAAIU,MAAM,KAAK,GAG/CD,KAAOZ,IAAUA,EACjBY,KAAOX,QAAUA,EAGjBP,EAAeiB,EAAM,SAAUT,GAC/BR,EAAeiB,EAAM,aAAcJ,EAAYL,EAAS,IAAM,IAC9DR,EAAeiB,EAAM,aAAcX,EAAIc,YAE9BL,EAAKF,IAAcD,IAAIZ,EAAakB,KAAMH,EAAMA,GAAQG,KAAKG,WAEtErB,GAAeiB,EAAM,QAASC,KAAKI,aAAeJ,KAAKK,aAGvDN,EAAOO,cAAclB,EAAImB,yBAEzBzB,EAAeiB,EAAM,cAAeR,GACpCT,EAAeiB,EAAM,OAAQV,EAAQmB,QAAQC,cAAgBC,EAAanB,IAG1ET,EAAeiB,EAAM,OAAQN,GAEH,IAApBL,EAAIqB,cAAsBE,EAAcvB,EAAIqB,eAElD3B,EAAiBiB,EAAMX,EAAIqB,aAAcrB,EAAIwB,UAC7C9B,EAAiBiB,EAAM,OAAQX,EAAIwB,WAC1Bb,EAAKc,qBA+Cd,QAASC,GAAQC,EAAQC,EAAKR,GAC9BR,KAAOe,OAAUA,EAAOE,cACxBjB,KAAOkB,KAAUF,EACjBhB,KAAOmB,QACPnB,KAAOoB,KAAU,KACjBpB,KAAOQ,QAAUhC,OAAO6C,OAAOC,EAAIC,gBACnCvB,KAAOwB,WAhMP,GAAIF,MACAG,EAAMC,OACNC,KACAjB,KAGEC,GACNiB,aAAiB,EACjBC,MAAiB,EACjBC,UAAiB,EACjBC,MAAiB,GAGXlD,GACNmD,wBAA0B,EAC1BC,iBAAmB,EACnBC,iBAAmB,GAGbvC,GAAe,KAAM,OAAQ,UAAW,WAAY,cAAe,eAEnEwC,EAAa,cAUnBb,GAAIc,QAAU,WAAcX,GAAOA,EAAIW,QAAU,KACjDd,EAAIC,gBACJc,OAAS,EACTxC,KAAQ,cAGRyB,EAAIgB,gBAAkB,SAAS/D,GAC/B,IAAOD,EAASC,GAAM,MAAOA,EAE7B,IAAMgE,KACN,KAAO,GAAIC,KAAOjE,GAAK,CACvB,GAAQS,GAAqB,QAAbT,EAAKiE,IAAkB,EAAOjE,EAAIiE,EAClDD,GAAUE,KAAQC,mBAAmBF,GAArC,IAA6CE,mBAAmB1D,IAEhE,MAASuD,GAAMI,KAAK,MAmBpBrB,EAAIsB,WAAa,SAASC,EAAMrC,GAChC,GAAMsC,KAmBN,OAjByB,gBAAZtC,GACbsC,EAASpC,cAAgBF,GACbuC,MAAMC,QAAQxC,KAC1BsC,EAASpC,aAAeF,GAGlBlC,EAASuE,GACfrE,OAAWyE,OAAOH,EAAMD,IAExBC,EAASD,KAAOA,EAChBrE,OAAWyE,OAAOH,EAAMtC,IAGxBsC,EAAOpC,aAAawC,QAAQ,SAAAC,GAA5BzC,EAAiDyC,GAAMN,IAEvDlB,EAAsBkB,GAAQC,EAErBD,GAGTvB,EAAIsB,WAAW,OAAQ,aACvBtB,EAAIsB,WAAW,cACflC,cAAiB,qCACjB0C,OAAU9B,EAAIgB,kBAGdhB,EAAIsB,WAAW,QACflC,cAAiB,oBACjB2C,OAAUC,KAAKC,MACfH,OAAUE,KAAKE,YA8CfrE,EAASV,WACTgF,UAAa,SAASjB,GACtB,MAAWxC,MAAK0D,SAASlB,EAAImB,gBAG7BrD,cAAiB,SAASa,GAC1B,GAAQK,GAAWL,EAAKlB,MAAMkC,GACtByB,KACAC,KACAC,EAAItC,EAAQ5B,OAAS,EACrBF,EAAI,CAIZ,KAFA8B,EAAYuC,MAEED,EAAJpE,GAAO,CACjB,GAAUsE,GAASxC,EAAQ9B,KACjBuE,EAASD,EAAO/D,MAAM,KACtBuC,EAASyB,EAAMC,QACflF,EAASiF,EAAMtB,KAAK,KAAKwB,MAEnCP,GAAapB,GAAOxD,EACpB6E,EAAerB,EAAImB,eAAiB3E,EAGpCF,EAAiBkB,KAAM,UAAW4D,GAClC9E,EAAiBkB,KAAM,WAAY6D,IAGnChD,mBAAsB,WACtB,GAAQhB,GAAUG,KAAKH,KACfuE,EAAUzC,EAAoB9B,GAC9BwE,EAAUrE,KAAK+B,IAEvB,IAAQlC,GAAQuE,GAAWA,EAAQf,OACnC,IACAgB,EAAeD,EAAQf,OAAO1E,KAAK0F,EAAMA,GACzCvF,EAAqBkB,KAAMH,EAAMwE,GACzB,MAAMC,IAGdxF,EAAiBkB,KAAM,OAAQqE,KAa/BvD,EAAQrC,WACR8F,IAAO,SAAS/B,EAAKxD,GAUrB,MATkB,UAAVA,EACEV,EAASkE,GACnBhE,OAAeyE,OAAOjD,KAAKmB,KAAMqB,GACpBxC,KAAKoB,KAAOoB,GAEf5D,EAAaI,KAAQgB,KAAKoB,KAAOpB,KAAKoB,MAAQ,GAAIoD,WAC5DxE,KAAWmB,KAAKqB,GAAOxD,GAGZgB,MAGXyE,UAAa,SAASjC,EAAKxD,GAK3B,MAJkB,UAAVA,GAAoBV,EAASkE,GACrChE,OAAayE,OAAOjD,KAAKwB,QAASgB,GACvBxC,KAAKwB,QAAQgB,GAAOxD,EAEpBgB,MAGX0E,UAAa,SAASC,EAAKC,GAE3B,MADA5E,MAASQ,QAAQmE,GAAOC,EACb5E,MAGXqC,MAAS,SAASuC,GAClB,MAAW5E,MAAK0E,UAAU,QAASE,IAGnCC,QAAW,SAASD,GACpB,MAAW5E,MAAK0E,UAAU,UAAWE,IAGrC/E,KAAQ,SAAS+E,GACjB,MAAW5E,MAAK0E,UAAU,OAAQE,IAGlCE,OAAU,SAASF,GACnB,MAAW5E,MAAK0E,UAAU,eAAgBE,IAG1CG,KAAQ,WACR,GAAQ3F,GAAM,GAAIqC,GAAIuD,eACdjF,EAAOC,KACPH,EAAOE,EAAKS,QAAQX,KACpBmB,EAAOjB,EAAKmB,KACZT,EAAeV,EAAKS,QAAQC,aAC5B2D,EAAUzC,EAAoB9B,GAC9B2B,EAAUhD,OAAO6C,OAAOtB,EAAKyB,SAC7BL,EAARrB,MAKA,KAFSD,EAAKoF,QAAQ,OAAMzD,EAAQ,gBAAkB3B,GAE9CrB,OAAO0G,KAAKnF,EAAKoB,MAAMvB,OAAS,GAAKG,EAAKqB,KAAM,CACxD,GAA0B,QAAhBrB,EAAKgB,OAAkB,CACjCI,EAAe,IACf,IAAYgE,GAAQ7D,EAAIgB,gBAAgBvC,EAAKoB,KACvB,MAAVgE,IAAcnE,IAAQA,EAAIiE,QAAQ,KAAO,IAAME,EAAQ,IAAMA,OAC5D,IAAIpF,EAAKqB,MAEtB,GADAD,EAAepB,EAAKqB,KACRD,YAAgBqD,UAC5B,IAAe,GAAIhC,KAAOzC,GAAKoB,KAA/BA,EAA0CiE,OAAO5C,EAAKrB,OAGtDA,GADiBiD,GAAWA,EAAQhB,OACrBgB,EAAQhB,OAAOzE,KAAKoB,EAAKoB,KAAMpB,EAAKoB,MAC/BpB,EAAKoB,MAEfiD,GAAa,gBAAkB5C,KAAUA,EAAQ,gBAAkB4C,EAAQ1D,aAAa,IAGlGtB,EAAQiG,KAAKtF,EAAKgB,OAAQC,EAAKjB,EAAKS,QAAQ6B,OAEpC5B,GAAgBE,EAAcF,KACtCrB,EAAUqB,aAAeA,EAGzB,KAAS,GAAIuD,KAAUxC,GACvBpC,EAAUkG,iBAAiBtB,EAAQxC,EAAQwC,GAG3C,OAAW,IAAI1C,GAAIc,QAAQ,SAASmD,EAASC,GAC7CpG,EAAUqG,iBAAiB,OAAQ,WACnC,GAAY7E,GAAW,GAAIzB,GAASC,EAAKW,EAEzCwF,GAAgB3E,KAGhBxB,EAAUqG,iBAAiB,QAAS,WAApCD,EAAiDpG,KAEvCW,EAAKS,QAAQqE,UACvBzF,EAAYyF,QAAU9E,EAAKS,QAAQqE,QAEnCzF,EAAYqG,iBAAiB,UAAW,WAAxCD,EAAqDpG,MAGrDA,EAAU2F,KAAK5D,OAKfG,EAAIR,QAAWA,EACfQ,EAAInC,SAAWA"}